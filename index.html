<!doctype html>
<html lang="en">
    <head>
<title>跑马灯效果 </title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<link rel="stylesheet" href="./lib/bootstrap-theme.min.css">
    <script src="./lib/jquery.min.js"></script>
    <script src="./lib/bootstrap.min.js"></script>  
    <script src="./lib/vue.js"></script>
    <style>
         
        </style>
</head>
    <body class="">
       
        <!--  标签页切换效果
        <div id="app" class="container">
            
            
            
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#new" >new</a></li>
                        <li ><a href="#blog" >blog</a></li>
                        <li ><a href="#about" >about</a></li>
                    </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="new">new

                </div>
                <div class="tab-pane " id="blog">blog

                    </div>
                     <div class="tab-pane " id="about">about

                        </div>
            </div>

           
        </div>
      <script>
          $("#myTab a").click(function(e){
              e.preventDefault;
              $(this).tab('show');
          })
      </script>   -->
              <!--    Bootstraps建表 然后vue.js进行了数据绑定和操作       -->           
              <div class="container ">
      <div id="app">
               <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">添加品牌</h3>
            </div>
                <div class="panel-body form-inline">
                <label>
                  Id: <input type="text" class="form-control"  v-model="id">
                  <!-- 
                      v-model实现数据的双向绑定
                  -->
                </label>
                <label>
                    Name: <input type="text"  class="form-control" v-model="name" v-focus="add" v-color="'blue'">
                    <!--  这里v-color 要设置颜色的话 不能直接加 而要先加一个单引号 变成字符串 不加单引号的话 就是变量了，会在Vue对象中去找这个变量-->
                    </label>
                    <label>
                            <input type="button" value="添加" class="btn btn-primary"@click="add()">
                        </label>
                        <label>
                            查询: <input type="text"  class="form-control" v-model="keyword">
                            </label>
                
            </div>
            </div>
<table class="table table-bordered table-hover table-striped">
    <thead>
    <tr>
    <th>Id</th>
    <th>Name</th>
    <th>Ctime</th>
    <th>Operation</th>
</tr>
    </thead>
    <tbody>
 <!--     <tr v-for="item in list" :key="item.id">此处v-for遍历一直是遍历的list数组，所以不管怎么都是同一个数组的对象，
        所以需要根据我们的需求重新构建一个方法，让这个遍历出来的数组项 符合我们的需求
     --><tr v-for="item in select(keyword)" :key="item.id">
            <td> {{item.id}} </td>
            <td>  {{item.name}} </td>
            <td> {{item.ctime|timeFormat("")}}  </td>
            <td> <a href="" @click.prevent="del(item.id)">删除</a>  </td> <!-- 给点击事件加上prevent移除默认的操作，并将同个作用域的id传进去 -->
        </tr>
    </tbody>
</table>
        </div>
    </div>
        <script>

            //声明全局过滤器
            //过滤器的使用方法为 ｛｛数据 | '过滤器的名称'｝｝ 命名规则 XXFormat  像是数据过滤器则是dataFormat
            //声明过滤器格式 Vue.filter('过滤器名称'，function('要传递进去的数据'){ 对数据进行的操作 }) 要传递进去的数据其实就是管道符'|'左边的参数
            //例如 {{item.ctime|timeFormat}}  则是左边的item.ctime
            Vue.filter('timeFormat',function(str,str2){//其中str2是通过timeFormat传进去的 用来判断用户想表示的时间的格式
                //根据给定的字符串的到特定的时间
                var time=new Date(str)
               var y=time.getFullYear()       //得到完整的年份
               var m=(time.getMonth()+1).toString().padStart(2,0)      //得到完整的月份 因为是从0开始 所以加1
               var d=(time.getDate()).toString().padStart(2,0)         //得到完整的日  getDay()是几号
               // return y +"-"+ m +"-" + d 
               // return `${y}-${m}-${d}` 也可以这样表示
               
               if(str2.toLowerCase()=="yyyy-mm-dd")//因为不知道用户是会输入大写还是小写 所以先默认全部小写 然后再判断
               {
                return y +"-"+ m +"-" + d 
               }else{
                   var hh =(time.getHours()).toString().padStart(2,0)
                   var mm =(time.getMinutes()).toString().padStart(2,0)
                   var ss =(time.getSeconds()).toString().padStart(2,0)
                   return y +"-"+ m +"-" + d +" "+hh+":"+mm+":"+ss
                   //此处的时分秒格式不正确 在1-10以内 是一位 而不是01这样的
                   //所以需要填充字符串 ES6中提供了填充字符串的方法
                   //Stirng.prototype.padStart() 或者Stirng.prototype.padEnd() 
                   //分别代表在前面填充 还是在后面填充 然后里面都有两个参数 第一个为总共几位 第二个为用什么填充
                   //这是字符类型的方法 所以要先把Date类型数据转换成数组类型 调用toString()方法
               }
            })
        
            //使用Vue.directive()定义全局的指令 比如 v-focus
            //其中，参数1：指令的名称 注意 在定义的时候，指令的名称前面不用加v-前缀
            //但是在调用的时候必须加  参数2：是一个对象，身上有一些指令相关的处理函数（钩子函数）这些函数可以在特定的阶段执行相关的操作
            
            Vue.directive('focus',{
                bind :function(el){ //el代表 我把指令绑定到谁身上 el就是谁
                    //每当指令绑定到元素上的时候，会立即执行这个bind函数 只执行一次
                    //注意：在每一个函数中，第一个参数永远是el，表示被绑定了指令的那个函数，这个el是个原生JS元素，也就是个DOM元素
                    //在元素，刚绑定了指令的时候 ，还没有插入到DOM中去，这时候你调用focus方法 没有作用
                    //因为，元素只有插入到DOM之后，才能获取焦点
                },
                inserted :function(el){
                    //每当指令要插入到DOM中的时候会执行一次
                    el.focus()
                    //和JS行为相关的操作，最好在inserted中去执行，防止行为不生效 
                },
                updated :function(el){
                    //每当VNode（DOM节点）更新的时候，会执行updated ，可能会触发多次
                }
            })
            Vue.directive('color',{
                bind :function(el,binding)
                //钩子函数的参数 binding 一个对象 包含name：指令名和value：指令的绑定值 计算后的值
                //expression：绑定值的字符串形式 不计算 原样输出
                {
                  
                    //这里之所以生效了 是因为这里只是个样式，不需要放进DOM就可以显示
                    //而focus 是一个JS行为 只有加载在DOM中才有意义
                    //样式，只要通过指令绑定了给元素，不管这个元素有没有被插入到页面中去，这个元素肯定有一个内联的样式
                    //将来元素肯定会显示在页面中去，这时候，浏览器的渲染引擎必然会解析样式，应用给这个元素
                    //和样式相关的操作一般都可以在bind中执行
                    //如果放JS行为的话，只是在内存里面存在，当元素从内存放入页面中的DOM的时候，是新建一个相同的元素，而那时就不会再次调用这个js行为了
                    el.style.color= binding.value
                    //通过钩子函数的binding参数来更改属性
                }
            })

            var vm = new Vue({
              el: '#app',
              data: {
                  id:'',
                 name:'',
                 keyword:'',
                 //新建一个keyword属性 用来根据keyword的值来查询list里面的name属性的值是否存在 从而实现查找功能
                list : [
                    {id:1,name:"宝马",ctime: new Date()},
                    {id:2,name:"奔驰",ctime: new Date()},
                    {id:3,name:"大众",ctime: new Date()},
                    {id:4,name:"宾利",ctime: new Date()},
                ]
              },
             methods:{
                 add(){
                     var car={ id: this.id,name: this.name,ctime:new Date()};
                     this.list.push(car);
                     this.id="";
                     this.name="";
                                     },
                                     //1.如何根据id来删除当前行？ 因为对象其实是个数组，可以将数组遍历一遍 找到符合的就可以停止遍历，并用splice()方法移除当前项
                                     //可以用some()方法来遍历，代码如下
                 del(id){
                   this.list.some((item,i)=>{
                        if(item.id==id){
                          this.list.splice(i,1);
                            return true;
                            
                        }
                    })

                 /*   var index=this.list.findIndex(item=>{
                        if(item.id==id)
                        {
                            return true;
                        }
                    })
                    console.log(index);
                    this.list.splice(index,1);*/
                 },
               
                     //首先要构建一个新数组 用来存放筛选出来的项
                 /*    var newList=[];
                     this.list.forEach(item => {
                         if(item.name.indexOf(keyword) !=-1)
                        {
                           newList.push(item);
                        }
                     })
                     return newList;*/
                     //注意foreEach some filter findIndex 都属于数组的新方法 都会对数组的每一项进行遍历执行相关操作
                     select(keyword){
                     var newList=[];
                     this.list.filter(item =>{
                         
                        //注意 ES6中，为字符串提供了一个新方法，叫做String.prototype.includes('要包含的字符串')
                        //如果包含则返回true 否则false;
                        //也可以用JQ的  :contain选择器
                         if(item.name.includes(keyword))
                         {
                            newList.push(item);
                         }
                     })
                     return newList;
                 }
             },//局部自定义指令函数
             directive:{
                 'fontSize':function(el,binding){
                     //如果你的代码只在binding中或者update中，那么你可以简写
                     //就是不写他的函数直接调用
                     el.style.fontSize=parseInt(binding.value)+"px"
                 }
             },
             //局部定义过滤器
             filter:{

             }
            });
          
        </script>
 

    
        </div>
    </body>
</html>
